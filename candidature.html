<script>
  const key = "LSM_CANDIDATURES";
  const WEBHOOK_URL = "TON_WEBHOOK_ICI";

  const form = document.getElementById("form");
  const msg = document.getElementById("msg");

  function getAll(){
    try { return JSON.parse(localStorage.getItem(key) || "[]"); }
    catch { return []; }
  }

  function saveAll(arr){
    localStorage.setItem(key, JSON.stringify(arr));
  }

  async function sendToDiscord(c){
    const payload = {
      username: "LS Midnight â€¢ Waitlist",
      embeds: [{
        title: "ðŸ“ Nouvelle Candidature RP",
        color: 14423100,
        fields: [
          { name: "Pseudo Discord", value: c.discord, inline: true },
          { name: "Ã‚ge", value: c.age, inline: true },
          { name: "Nom RP", value: c.nomrp },
          { name: "ExpÃ©rience RP", value: c.xp },
          { name: "Motivation", value: c.motivation.slice(0,1024) },
          { name: "Background RP", value: c.background.slice(0,1024) }
        ],
        timestamp: new Date().toISOString()
      }]
    };

    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const fd = new FormData(form);
    const c = {
      discord: fd.get("discord"),
      age: fd.get("age"),
      nomrp: fd.get("nomrp"),
      xp: fd.get("xp"),
      motivation: fd.get("motivation"),
      background: fd.get("background"),
      createdAt: Date.now()
    };

    const all = getAll();
    all.push(c);
    saveAll(all);

    await sendToDiscord(c);

    msg.textContent = "âœ… Candidature envoyÃ©e sur Discord.";
    form.reset();
  });
</script>
