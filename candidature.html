<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candidature - LS Midnight</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script defer src="assets/app.js"></script>
</head>
<body>
  <header class="nav">
    <div class="container">
      <div class="nav-inner">
        <a class="brand" href="index.html">
          <img src="images/logo.png" alt="Logo LS Midnight" class="logo-img">
          <div>
            <div class="brand-title">LS Midnight : Roleplay</div>
            <div class="brand-sub">Candidature Waitlist</div>
          </div>
        </a>

        <nav class="links">
          <a class="link" href="index.html">Accueil</a>
          <a class="link" href="reglement-rp.html">R√®glement RP</a>
          <a class="link" href="reglement-discord.html">R√®glement Discord</a>
          <a class="link" href="metiers.html">M√©tiers</a>
          <a class="link" href="boutique.html">Boutique</a>
        </nav>

        <a class="btn btn-red" target="_blank" rel="noreferrer" href="https://discord.gg/ctzPkVGn5K">Discord</a>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <h1>üìù Candidature RP (Waitlist)</h1>
      <p class="small">La candidature est envoy√©e sur Discord automatiquement.</p>

      <div class="card" style="margin-top:16px;">
        <form id="form">
          <div class="row">
            <div>
              <label class="small">Pseudo Discord</label>
              <input class="input" name="discord" placeholder="ex: MonPseudo" required />
            </div>
            <div>
              <label class="small">√Çge</label>
              <input class="input" name="age" type="number" min="13" max="99" required />
            </div>
          </div>

          <div class="row" style="margin-top:12px;">
            <div>
              <label class="small">Nom RP</label>
              <input class="input" name="nomrp" placeholder="Pr√©nom Nom" required />
            </div>
            <div>
              <label class="small">Exp√©rience RP</label>
              <select class="select" name="xp" required>
                <option value="">Choisir...</option>
                <option>D√©butant</option>
                <option>Interm√©diaire</option>
                <option>Confirm√©</option>
              </select>
            </div>
          </div>

          <div style="margin-top:12px;">
            <label class="small">Motivation</label>
            <textarea class="textarea" name="motivation" required></textarea>
          </div>

          <div style="margin-top:12px;">
            <label class="small">Background RP (r√©sum√©)</label>
            <textarea class="textarea" name="background" required></textarea>
          </div>

          <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-red" type="submit">Envoyer</button>
          </div>

          <div id="msg" class="small" style="margin-top:10px;"></div>
        </form>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container" style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
      <div>¬© <span data-year></span> LS Midnight : Roleplay</div>
      <div><a href="https://discord.gg/ctzPkVGn5K" target="_blank" rel="noreferrer">Discord</a></div>
    </div>
  </footer>

  <script>
    // ‚úÖ Webhook Discord
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1477320308351439001/mvklhBTHHPBnHnZZOEBmnFir6kFLJncOwI6OdZ8muVysyZdNs6XQtVF90mvPJmFWSRs6";

    // ‚úÖ Anti page blanche : on attend que tout soit charg√© avant d'initialiser
    window.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("form");
      const msg = document.getElementById("msg");

      if (!form || !msg) {
        console.error("Erreur: #form ou #msg introuvable.");
        return;
      }

      async function sendToDiscord(c) {
        const payload = {
          username: "LS Midnight ‚Ä¢ Waitlist",
          embeds: [{
            title: "üìù Nouvelle Candidature RP (Waitlist)",
            color: 14423100,
            fields: [
              { name: "üë§ Pseudo Discord", value: c.discord || "‚Äî", inline: true },
              { name: "üéÇ √Çge", value: String(c.age || "‚Äî"), inline: true },
              { name: "üßæ Nom RP", value: c.nomrp || "‚Äî", inline: false },
              { name: "üìà Exp√©rience RP", value: c.xp || "‚Äî", inline: true },
              { name: "üî• Motivation", value: (c.motivation || "‚Äî").slice(0, 1024), inline: false },
              { name: "üìö Background", value: (c.background || "‚Äî").slice(0, 1024), inline: false }
            ],
            timestamp: new Date().toISOString()
          }]
        };

        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        // Discord OK = 204
        if (!res.ok) {
          const txt = await res.text().catch(() => "");
          throw new Error("Webhook error " + res.status + " " + txt);
        }
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.textContent = "‚è≥ Envoi en cours...";

        const fd = new FormData(form);
        const c = {
          discord: String(fd.get("discord") || ""),
          age: String(fd.get("age") || ""),
          nomrp: String(fd.get("nomrp") || ""),
          xp: String(fd.get("xp") || ""),
          motivation: String(fd.get("motivation") || ""),
          background: String(fd.get("background") || "")
        };

        try {
          await sendToDiscord(c);
          msg.textContent = "‚úÖ Candidature envoy√©e sur Discord !";
          form.reset();
        } catch (err) {
          console.error(err);
          msg.textContent = "‚ùå Erreur envoi Discord. Ouvre F12 > Console pour voir l‚Äôerreur.";
        }
      });
    });
  </script>
</body>
</html>
