<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candidature (Waitlist) - LS Midnight</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script defer src="assets/app.js"></script>
</head>
<body>
  <header class="nav">
    <div class="container">
      <div class="nav-inner">
        <a class="brand" href="index.html">
          <div class="logo"></div>
          <div>
            <div class="brand-title">LS Midnight : Roleplay</div>
            <div class="brand-sub">Candidature (Waitlist)</div>
          </div>
        </a>
        <nav class="links">
          <a class="link" href="index.html">Accueil</a>
          <a class="link" href="reglement-rp.html">Règlement RP</a>
          <a class="link" href="reglement-discord.html">Règlement Discord</a>
          <a class="link" href="musiques.html">Musiques</a>
          <a class="link" href="metiers.html">Métiers</a>
          <a class="link" href="boutique.html">Boutique</a>
        </nav>
        <a class="btn btn-red" target="_blank" rel="noreferrer" href="https://discord.gg/ctzPkVGn5K">Rejoindre Discord</a>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <h1>Candidature RP (Waitlist)</h1>
      <p class="small">V1 : stockage local (sur le PC du joueur). V2 : envoi vers Discord / base de données.</p>

      <div class="card" style="margin-top:16px;">
        <form id="form">
          <div class="row">
            <div>
              <label class="small">Pseudo Discord</label>
              <input class="input" name="discord" placeholder="ex: MonPseudo#0000" required />
            </div>
            <div>
              <label class="small">Âge</label>
              <input class="input" name="age" type="number" min="13" max="99" required />
            </div>
          </div>

          <div class="row" style="margin-top:12px;">
            <div>
              <label class="small">Nom RP</label>
              <input class="input" name="nomrp" placeholder="Prénom Nom" required />
            </div>
            <div>
              <label class="small">Expérience RP</label>
              <select class="select" name="xp" required>
                <option value="">Choisir...</option>
                <option>Débutant</option>
                <option>Intermédiaire</option>
                <option>Confirmé</option>
              </select>
            </div>
          </div>

          <div style="margin-top:12px;">
            <label class="small">Motivation</label>
            <textarea class="textarea" name="motivation" placeholder="Explique pourquoi tu veux rejoindre LS Midnight..." required></textarea>
          </div>

          <div style="margin-top:12px;">
            <label class="small">Background RP (résumé)</label>
            <textarea class="textarea" name="background" placeholder="Histoire rapide du personnage..." required></textarea>
          </div>

          <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-red" type="submit">Envoyer</button>
            <button class="btn" type="button" id="see">Voir mes candidatures</button>
          </div>

          <div id="msg" class="small" style="margin-top:10px;"></div>
        </form>
      </div>

      <div id="list" class="grid" style="margin-top:14px;"></div>
    </div>
  </main>

  <footer class="footer">
    <div class="container" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;">
      <div>© <span data-year></span> LS Midnight : Roleplay</div>
      <div><a href="https://discord.gg/ctzPkVGn5K" target="_blank" rel="noreferrer">Discord</a></div>
    </div>
  </footer>

  <script>
    const key = "LSM_CANDIDATURES";
    const form = document.getElementById("form");
    const msg = document.getElementById("msg");
    const list = document.getElementById("list");
    const see = document.getElementById("see");

    function getAll(){
      try { return JSON.parse(localStorage.getItem(key) || "[]"); }
      catch { return []; }
    }

    function saveAll(arr){
      localStorage.setItem(key, JSON.stringify(arr));
    }

    function render(){
      const items = getAll().slice().reverse();
      if (!items.length){
        list.innerHTML = "";
        return;
      }
      list.innerHTML = items.map(c => `
        <div class="card">
          <div class="card-title">${c.nomrp} <span class="badge" style="margin-left:8px;">${c.status}</span></div>
          <div class="small">Discord: ${c.discord} • Âge: ${c.age} • XP: ${c.xp}</div>
          <hr class="hr"/>
          <div class="small"><b>Motivation:</b> ${escapeHtml(c.motivation).slice(0,240)}...</div>
          <div class="small" style="margin-top:6px;"><b>Background:</b> ${escapeHtml(c.background).slice(0,240)}...</div>
          <div class="small" style="margin-top:10px;opacity:.75;">Envoyée le: ${new Date(c.createdAt).toLocaleString()}</div>
        </div>
      `).join("");
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const c = {
        discord: fd.get("discord"),
        age: fd.get("age"),
        nomrp: fd.get("nomrp"),
        xp: fd.get("xp"),
        motivation: fd.get("motivation"),
        background: fd.get("background"),
        status: "Reçue",
        createdAt: Date.now()
      };
      const all = getAll();
      all.push(c);
      saveAll(all);
      msg.textContent = "✅ Candidature enregistrée (V1 local).";
      form.reset();
      render();
    });

    see.addEventListener("click", render);
  </script>
</body>
</html>
