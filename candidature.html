<script>
  // ‚ö†Ô∏è Met ton webhook ici (id√©alement un nouveau, car celui-ci a √©t√© expos√©)
  const WEBHOOK_URL = "https://discord.com/api/webhooks/1477320308351439001/mvklhBTHHPBnHnZZOEBmnFir6kFLJncOwI6OdZ8muVysyZdNs6XQtVF90mvPJmFWSRs6";

  const form = document.getElementById("form");
  const msg = document.getElementById("msg");
  const list = document.getElementById("list");
  const see = document.getElementById("see");

  // Optionnel : garde aussi une copie locale pour que le joueur voie ce qu‚Äôil a envoy√©
  const key = "LSM_CANDIDATURES";
  function getAll(){
    try { return JSON.parse(localStorage.getItem(key) || "[]"); }
    catch { return []; }
  }
  function saveAll(arr){ localStorage.setItem(key, JSON.stringify(arr)); }
  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function render(){
    const items = getAll().slice().reverse();
    if (!items.length){ list.innerHTML=""; return; }
    list.innerHTML = items.map(c => `
      <div class="card">
        <div class="card-title">${escapeHtml(c.nomrp)} <span class="badge" style="margin-left:8px;">Envoy√©e</span></div>
        <div class="small">Discord: ${escapeHtml(c.discord)} ‚Ä¢ √Çge: ${escapeHtml(c.age)} ‚Ä¢ XP: ${escapeHtml(c.xp)}</div>
        <hr class="hr"/>
        <div class="small"><b>Motivation:</b> ${escapeHtml(c.motivation).slice(0,240)}...</div>
        <div class="small" style="margin-top:6px;"><b>Background:</b> ${escapeHtml(c.background).slice(0,240)}...</div>
        <div class="small" style="margin-top:10px;opacity:.75;">Envoy√©e le: ${new Date(c.createdAt).toLocaleString()}</div>
      </div>
    `).join("");
  }
  if (see) see.addEventListener("click", render);

  async function sendToDiscord(payload){
    const res = await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    // Discord r√©pond 204 No Content si ok
    if (!res.ok) {
      const txt = await res.text().catch(() => "");
      throw new Error(`Erreur webhook (${res.status}) ${txt}`);
    }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    msg.textContent = "‚è≥ Envoi en cours...";

    const fd = new FormData(form);

    const discord = String(fd.get("discord") || "");
    const age = String(fd.get("age") || "");
    const nomrp = String(fd.get("nomrp") || "");
    const xp = String(fd.get("xp") || "");
    const motivation = String(fd.get("motivation") || "");
    const background = String(fd.get("background") || "");

    // ‚úÖ Message Discord joli (embed)
    const payload = {
      username: "LS Midnight ‚Ä¢ Waitlist",
      // avatar_url: "https://exemple.com/ton-logo.png", // optionnel
      embeds: [
        {
          title: "üìù Nouvelle Candidature RP (Waitlist)",
          color: 14423100, // rouge (en decimal)
          fields: [
            { name: "üë§ Pseudo Discord", value: discord || "‚Äî", inline: true },
            { name: "üéÇ √Çge", value: age || "‚Äî", inline: true },
            { name: "üßæ Nom RP", value: nomrp || "‚Äî", inline: false },
            { name: "üìà Exp√©rience RP", value: xp || "‚Äî", inline: true },
            { name: "üî• Motivation", value: (motivation || "‚Äî").slice(0, 1024), inline: false },
            { name: "üìö Background", value: (background || "‚Äî").slice(0, 1024), inline: false },
          ],
          footer: { text: "LS Midnight : Roleplay ‚Ä¢ Waitlist" },
          timestamp: new Date().toISOString(),
        }
      ],
    };

    try {
      await sendToDiscord(payload);

      // Optionnel : sauvegarde locale
      const all = getAll();
      all.push({ discord, age, nomrp, xp, motivation, background, createdAt: Date.now() });
      saveAll(all);

      msg.textContent = "‚úÖ Candidature envoy√©e sur Discord !";
      form.reset();
      render();
    } catch (err) {
      console.error(err);
      msg.textContent = "‚ùå Erreur : impossible d‚Äôenvoyer la candidature (webhook).";
    }
  });
</script>
